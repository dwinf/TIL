# 리눅스와 친해지기

## 01. Overview

리눅스를 한다는 것은

- 커널 프로그래밍, 서버운용, 머신러닝

- 도커, 클라우드, 쉘 스크립트 등...

### GUI Vs CLI

GUI(Graphical User Interface)

- 한 화면에 많은 정보 담을 수 있음

- 눈으로 보고 대상을 선택 가능

- 그러나 한 화면에서 다양한 일을 하게 된다면?

CLI(Command-Line Interface)

- 눈에 보이는 거라곤 터미널

- 뭔가 하고 싶어도 몰라서 할 수 없음

- 까막눈이면 몰라도, 숙련자에겐?

**처음엔 좋아도 복잡도가 증가하면 GUI의 비용은 급격히 증가**

### 리눅스를 잘 다룬다는 것은

- 리눅스 환경에서 파일, 프로그램을 얼마나 잘 다루는가?

- **CLI 환경**이 얼마나 익숙한가?

---

## 02. Linux 란?

> **리눅스 커널**을 사용하는 Unix 계열 **운영체제**
> 
> 대규모 **오픈소스** 프로젝트 by 리누스 토르발스

### 커널? 운영체제?

- User Space
  
  - 웹 브라우저, 탐색기, 게임, 음악 재생, 계산기 등..

- Kernel Space
  
  - OS > Kernel
  
  - **Linux** Kernel, Windows Kernel, Unix Kernel

- Hardware

### Linux family

- ubuntu, fedora, debian, Red Hat, centOS, android, Etc...

---

## 04. Linux 활용

### Shell(셸)

Hardware < Kernel < **Shell** < Utilities

- 운영체제 상에서 사용자와 커널 사이에 존재

- **사용자의 명령을 해석하고 처리결과를 출력**해주는 프로그램

### Shell 종류

| shell 종류 | 리눅스                 | 윈도우             |
| -------- | ------------------- | --------------- |
| CLI      | bash, zsh, csh, ksh | cmd, Powershell |
| GUI      | Gnome               | Explorer        |

윈도우라고 해서 CLI 환경이 없는 것은 아니고

리눅스라고 해서 GUI 환경이 없는 것은 아님

### 기본 명령어

- tail

- grep

- which

- man

- l / ls
  
  - -l : 상세정보
  
  - -a : 모든 항목 표시

- alias : 별칭
  
  - `unalias 별칭` : alias 해제

```bash
$ alias

alias alert='notify-send --urgency=low -i "$([ $? = 0 ] && echo terminal || echo error)" "$(history|tail -n1|sed -e '\''s/^\s*[0-9]\+\s*//;s/[;&|]\s*alert$//'\'')"'

alias egrep='egrep --color=auto'

alias fgrep='fgrep --color=auto'

alias grep='grep --color=auto'

alias l='ls -CF'

alias la='ls -A'

alias ll='ls -alF'

alias ls='ls --color=auto'
```

- mv : 이동 또는 이름 변경

```bash
$ mkdir 0717

$ l
0717/

$ mv 0717 test0717

$ l
test0717/
```

- mkdir

- touch

- cd : 이동
  
  - `.` : 현재 디렉토리
  - `..` : 상위 디렉토리
  - `/` : 최상위 디렉토리
  - `\~, \$, (공백)` : 홈 디렉토리

- rm
  
  - linux에서는 휴지통이 없음, 한번 지우면 그냥 지워짐
  
  - `rm -i ###` : 정말 지울 것인지 물어봄

- rmdir / rm -rf

- top / htop : cpu/memory 등 리소스 현황
  
  - htop이 좀더 보기좋음
  
  - q로 종료

- ps : 현재 실행 중인 프로세스

```bash
$ ps
 PID TTY          TIME CMD
 1837 pts/1    00:00:00 bash
 1861 pts/1    00:00:00 ps

 $ ps -ef
 UID        PID  PPID  C STIME TTY          TIME CMD
```

- df : 디스크 사용 현황

```bash
$ df -H

Filesystem      Size  Used Avail Use% Mounted on
udev            491M     0  491M   0% /dev
tmpfs           103M  775k  102M   1% /run
/dev/xvda1      8.3G  1.2G  7.1G  15% / ## Root
tmpfs           514M     0  514M   0% /dev/shm
tmpfs           5.3M     0  5.3M   0% /run/lock
tmpfs           514M     0  514M   0% /sys/fs/cgroup
/dev/loop0      102M  102M     0 100% /snap/core/9289
/dev/loop1       19M   19M     0 100% /snap/amazon-ssm-agent/1566
tmpfs           103M     0  103M   0% /run/user/1000
```

- du : 현재 디렉토리 이하 디렉토리에서 사용하고 있는 disk 용량 확인, 보통 `ls`로 확인

```bash
$ du
4       ./.cache
4       ./.gnupg/private-keys-v1.d
8       ./.gnupg
4       ./test0717
8       ./.config/htop
12      ./.config
8       ./.ssh
52 .

$ du -a
0       ./.cache/motd.legal-displayed
4       ./.cache
4       ./.gnupg/private-keys-v1.d
8       ./.gnupg
4       ./.profile
4       ./.bashrc
4       ./.bash_logout
4       ./test0717
4       ./.config/htop/htoprc
8       ./.config/htop
12      ./.config
4       ./.ssh/authorized_keys
8       ./.ssh
52 .
```

- find : 검색, `grep` 과 같이 사용

```bash
$ find
.
./.cache
./.cache/motd.legal-displayed
./.gnupg
./.gnupg/private-keys-v1.d
./.profile
./.bashrc
./.bash_logout
./test0717
./.config
./.config/htop
./.config/htop/htoprc
./.ssh
./.ssh/authorized_keys

$ find | grep "test"
./test0717

$ find | grep "config"
./.config
./.config/htop
./.config/htop/htoprc
```

- man : manual, q로 종료

```bash
$ man ls

$ man sudo

$ man nohup
```

- which : 해당 명령어가 실행되고 있는 위치
  
  - 파이썬 가상환경이 다수인 경우 그 중에서 어떤 파이썬이 실행되고 있는지 파악할 때

```bash
$ which python3
/usr/bin/python3
```

- echo
  
  - redirection ; 출력된 것 저장
  
  - `echo 내용 > 파일` : 해당 파일에 내용 저장
  
  - `echo 내용 >> 파일` : 해당 파일 하단에 내용 추가

- tail : 해당 파일의 아랫 부분 출력
  
  - `tail -f 파일` : 다른 쉘에서 추가하는 내용 실시간으로 추적, 로그로 활용

```bash
$ echo 2341
2341

$ echo 311 > test

$ cat test
311

$ echo 123123>> test

$ echo123123>> test

$ echo 123123>> test

$ cat test
311
123123
123123
123123

$ tail test
311
123123
123123
123123
123123

$ tail -f test
311
123123
123123
123123
123123
```

### 여러 명령어를 한번에

` ; ` : `명령어; 명령어; 명령어`

- 중간에 syntax 틀린 명령어가 있는 경우 중단 없이 뒤 명령어도 모두 실행

```bash
$ echo aa ; echo bb;
aa
bb

$ echocho aa ; echo bb;
echocho: command not found
bb
```

`&&(and) , ||(or)`

```bash
$ echo aa || echo bb
aa

$ echo aa && echo bb
aa
bb

$ echocho aa && echo bb
echocho: command not found

$ echocho aa || echo bb
echocho: command not found
bb
```

` |(pipe) `

: 명령어 실행 결과에 대한 2차 처리

- `grep`, `awk`

```bash
$ ls | grep "test"
test
test0717

# "test" 뻬고 출력

$ ls | grep -v "test"
```

#### Text file에서 검색

sample file 생성

```bash
$ touch sm

$ vi sm
```

파일 sm에서 "WARN"이 포함된 곳 검색

- ` -n ` : numbering; 맨 앞에 몇번째 줄인지 표시

```bash
$ cat sm | grep "WARN" -n
29:03/22 08:51:06 WARNING:.....mailslot_create: setsockopt(MCAST_ADD) failed - EDC8116I Address not available.
35:03/22 08:51:06 WARNING:.....mailslot_create: setsockopt(MCAST_ADD) failed - EDC8116I Address not available.
42:03/22 08:51:06 WARNING:.....mailslot_create: setsockopt(MCAST_ADD) failed - EDC8116I Address not available.
48:03/22 08:51:06 WARNING:.....mailslot_create: setsockopt(MCAST_ADD) failed - EDC8116I Address not available.
```

출력 결과를 파일로 저장

- `cat sm | grep "WARN" -n > ./warn_log.txt`

- `> 파일 경로`

```bash
$ cat sm | grep "WARN" -n > ./warn_log.txt

$ l
sm  warn_log.txt

$ cat warn_log.txt
29:03/22 08:51:06 WARNING:.....mailslot_create: setsockopt(MCAST_ADD) failed - EDC8116I Address not available.
35:03/22 08:51:06 WARNING:.....mailslot_create: setsockopt(MCAST_ADD) failed - EDC8116I Address not available.
42:03/22 08:51:06 WARNING:.....mailslot_create: setsockopt(MCAST_ADD) failed - EDC8116I Address not available.
48:03/22 08:51:06 WARNING:.....mailslot_create: setsockopt(MCAST_ADD) failed - EDC8116I Address not available.
```

#### `awk`

- 특정 위치에 있는 내용만 출력

- 반드시 작은 따옴표 사용

```bash
$ ll
total 20
drwxrwxr-x 2 ubuntu ubuntu 4096 Jul 17 06:56 ./
drwxr-xr-x 7 ubuntu ubuntu 4096 Jul 17 06:52 ../
-rw-rw-r-- 1 ubuntu ubuntu 4495 Jul 17 06:52 sm
-rw-rw-r-- 1 ubuntu ubuntu  444 Jul 17 06:56 warn_log.txt

$ ll | awk '{ print $1 }'
total
drwxrwxr-x
drwxr-xr-x
-rw-rw-r--
-rw-rw-r--
```

### File Descriptor

표준 입출력, 에러를 숫자로 표현

```bash
$ touch err_test

$ dvnsfgg 1> err_test
dvnsfgg: command not found

$ dvnsfgg 2> err_test

$ cat err_test
dvnsfgg: command not found
```

### vi 편집기

터미널 환경에서 쓸 수 있는 몇 안되는 편집기

- command mode 
  
  - esc 누른 상태
  
  - 키보드로 입력 불가
  
  - 수정/삭제/복사/붙이기 등

- editor mode
  
  - command mode에서 i, a, o 누른 상태
  
  - 키보드 입력 가능,

- last line mode
  
  - Command Mode 에서 : (콜론)
  
  - 파일을 저장하거나 종료 or 문서검색

```bash
$ vi
```

![image](https://user-images.githubusercontent.com/57997672/87758497-85b9c900-c847-11ea-8919-034c2b3b2191.png)

```bash
# 에디터에 코드 줄번호 표시
:set nu

# command mode에서 줄단위 잘라내기
dd

# 붙여넣기
p

# 되돌리기
u

# 줄 끝으로 이동
shift 4

# vi로 새 파일 생성한 경우, 파일이름 지정 후 저장하고 종료해야 함
w FILENAME
```

### 알아두면 좋은 Tool

- apt-get

- nohup
  
  - 터미널이 꺼지더라도 내 스크립트를 계속 실행시키고 싶을 때, & 과 함께 백그라운드 실행

- screen(tmux)
  
  - nohup과 유사, 세션 복원 가능

---

## 05. 리눅스 이해

### 계정과 보안

권한 `drwxrwxrwx`

- d : Directory

- r : Read

- w : Write

- x : Excute 

`chmod 777`

- 순서대로 Owner, Group, Others

### sudo

root 권한 남발하지 않고 필요한 경우에만 일시적으로 root 권한 위임

`sudo reboot` : root 권한 없으면 reboot도 불가능

### 환경변수 `$PATH`

프로그램을 실행할 때 자동으로 참조하는 절대경로

현재 사용하는 환경변수 확인

- 왼쪽으로 갈수록 높은 우선순위

```bash
$ echo $PATH
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin
```

- /bin : 기본 명령어

- /sbin : 시스템 관리 위한 명령어, root 권한 필요

- /usr/bin : /bin에 없는 기본 명령어

- /usr/sbin : /sbin에 없는 시스템 관리 명령어, root 권한 필요

#### `export`

환경 변수 추가

```bash
$ export
declare -x HOME="/home/ubuntu"
declare -x LANG="C.UTF-8"
declare -x LESSCLOSE="/usr/bin/lesspipe %s %s"
declare -x LESSOPEN="| /usr/bin/lesspipe %s"
declare -x LOGNAME="ubuntu"
```

- 프로그램을 실행할 때 자동으로 참조하는 절대경로의 모음

- export 명령어로 환경변수를 추가 (일시적)

---

## 06. Shell Script

셸 위에서 실행 가능한 명령어를 조합해서 작업을 자동화

### 셔뱅(Shabang)

셸 스크립트 시작할 때 맨 처음에 기입하여 스크립트를 해석하는 **인터프리터 지정**

```bash
$ vi ss_test
 #!/bin/bash
 echo "Welcome LINUX!"

# bash를 특정하여 실행하면 셔뱅이 없어도 실행 가능
$ bash ss_test
Welcome LINUX!

# hello를 실행가능 파일로 변경
$ chmod 755 hello

$ cat ss_test
#!/bin/bash
echo "Welcome LINUX!"

$ ss_test

Command 'ss_test' not found, but can be installed with:

sudo apt install ss_test 

sudo apt install ss_test-traditional

# 현재 폴더로 지정하면 실행 가능
$ ./ss_test
Welcome LINUX!

# 환경변수 등록된 위치로 이동(권한 필요)
$ sudo mv ss_test /usr/bin

# 파일 이름만으로도 실행 가능
$ ss_test

Welcome LINUX!
```

#### 파이썬도 가능

```bash
$ vi py_test
#!/usr/bin/python3
import os
print(os.listdir())

$ chmod 755 py_test
$ ./py_test
```

### 변수 variable

- 선언 : `VAR= `

- 사용 : `$VAR`

- 특수한 경우 : `${VAR}`

- 매개변수 : `$0`, `$1` ... `$*`, `$@`

- 산술 은 추가적인 처리가 필요

```bash
$ echo `expr 1+2`

1+2

$ echo `expr 1 + 2`

3

$ echo $((1+2))

3

$ echo $((1 + 2))

3
```

### 조건문, 비교 연산

`if ~ then ~ elif then ~ fi`

- 정수 `-eq, -ne, -gt, -lt, -ge, -le`
- 문자열 `==, !=, -z, -n`
- 조건문은 `[]`로 묶어줌
### 반복문

- while

- for

- break, continue, exit

### 유의사항

- space 필요한 곳은 확실히 넣어줘야 함
  
  - 변수 선언 주의

- 중간에 에러나도 계속 진행

- 엔터 잘못 쳤다가 전부 날림
  
  - **`rm`** 사용시 주의

### 실습

- touch, for/while 사용해서 파일 30개 만들기
  
  ```bash
  #!/bin/bash
  
  count=30
    
  while [ $count -gt 0 ]
  do
  
  touch "ff$count"
  count=$(( $count - 1 ))

  done
  ```

- 1에서 만든 파일들 이름을 test1 ~ test30 로 변경
- 숫자 [+, -, *, /] 숫자 입력 받아서 계산 결과 출력
