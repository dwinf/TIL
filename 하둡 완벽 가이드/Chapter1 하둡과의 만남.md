# 하둡 완벽 가이드 4판

## Chapter1 하둡과의 만남

### 1.1 데이터!

> 수많은 곳에서 엄청난 데이터가 만들어지도 있다.

- 개인이 만들어내는 데이터의 족적 증가
- 기계 로그, RFID 리더, 센서 네트워크, 차량 GPS 궤적, 소매거래 등 기계 데이터 폭증
- 공개 데이터의 크기 증가

### 1.2 데이터 저장소와 분석

> 데이터를 읽는 속도가 하드 디스크 용량 증가에 미치지 못했다.

데이터를 읽는 시간을 줄이기 위해 여러 개의 디스크에서 동시에 데이터를 읽음

#### 데이터를 병렬로 읽거나 쓸 때 고려할 문제

1. 하드웨어 장애
   
   - 다수의 데이터 백업으로 극복(RAID)
   - HDFS

2. 분할된 데이터의 결합
   
   - 맵리듀스
     - 디스크에서 데이터를 읽고 쓰는 문제를 키-값 쌍의 계산으로 변환한 추상화된 프로그래밍 모델을 제공
     - 맵과 리듀스로 분리 되어 있고, 그 둘 사이를 **혼합**해 주는 인터페이스가 있다

### 1.3 전체 데이터에 질의하기
- 맵리듀스의 접근법은 무차별 대입(brute-force) 방식처럼 보임
- 맵리듀스의 전제가 한 번의 쿼리로 전체나 상당한 규모의 데이터셋을 처리하는 것
- 맵리듀스의 장점
- 맵리듀스는 **일괄 질의 처리기**
- 전체 데이터셋을 대상으로 비정형(ad hoc) 쿼리를 수행
- 합리적인 시간 내에 결과를 보여줌

### 1.4 일괄 처리를 넘어서
맵리듀스의 강점은 일괄 처리 시스템이라는 것. 대화형 분석에는 적합하지 않음(질의의 결과를 받는데 오래 걸리기 때문에)

'하둡'은 하둡 에코시스템을 지칭하는 말로 사용되고, 하둡 에코시스템은 분산 컴퓨팅과 대규모 데이터 처리를 위한 기반 시설이다.

- HBase
   - HDFS를 기본 저장소로 하는 키-값 저장소다.
   - 온라인 접근을 지원하는 첫 번째 구성요소
   - 개별 행에 대한 온라인 읽기/쓰기
   - 산적한 데이터를 읽고 쓰는 일괄 처리 지원

- YARN(Yet Another Resource Negotiator)
   - 클러스터 자원 관리 시스템
   - 맵리듀스 뿐만 아니라 어떤 분산 프로그램도 하둡 클러스터에 저장된 데이터를 처리할 수 있게 해준다.

#### 하둡 기반 처리 패턴
- 대화형 SQL
   - 맵리듀스 대신 장기 실행 전용 데몬(임팔라) 엔진 사용
   - 컨테이너를 재사용하는 (테즈 기반의 하이브) 분산 쿼리 엔진 사용
   - 대용량 데이터셋에 대한 확장성이 있으면서 하둡 기반의 SQL 쿼리를 실행할 때 빠른 응답 속도를 갖는다.

- 반복 처리
   - 머신러닝과 같은 다수의 알고리즘은 근본적으로 반복 연산
   - 메모리에 임시 작업 데이터셋을 보존하여 디스크에서 읽는 수고를 줄임
   - 맵리듀스는 안되지만 스파크를 사용하면 데이터셋을 탐색하는 방식의 작업을 허용한다.

- 스트림 처리
   - 스톰 (Storm), 스파크 스트리밍(Spark Streaming), 삼자(Samza) 등
   - 실시간 실행되고 경계가 없는 스트림 데이터를 분산 계산하여 그 결과를 하둡 저장소나 외부 시스템에 보낼 수 있다.

- 검색
   - 솔라(Solr)
   - 문서를 색인하여 HDFS에 저장하고 HDFS에 저장된 색인을 기반으로 검색 쿼리를 제공한다.

### 1.5 다른 시스템과의 비교
#### 관계형 데이터베이스 관리 시스템(RDBMS)
왜 여러 개의 디스크를 가진 데이터베이스를 이용하여 대규모 분석을 수행할 수 없을까?
- 탐색은 데이터를 읽거나 쓸 때 디스크의 헤더를 디스크 특정 위치로 이동시키는 조작
- 전송 속도는 디스크의 대역폭과 관련

||RDBMS|맵리듀스|
|---|---|---|
|데이터 크기|**기가바이트**|**페타바이트**|
|접근 방식|대화형, 일괄처리방식|**일괄처리방식**|
|변경|**여러번 읽고 쓰기**|한번 쓰고 여러번 읽기|
|트랜잭션|ACID|없음|
|구조|쓰기 수준 스키마|읽기 수준 스키마|
|무결성|높음|낮음|
|확장성|비선형|선형|
RDBMS는 하둡의 개념을 포함하기 시작하고, 하둡 시스템은 대화형으로 발전해 나가는 등 차이가 불분명해지고 있다.

##### 함둡 Vs RDBMS
> 데이터셋 내부에서 처리되는 구조의 양
- **정형 데이터**는 미리 정의된 스키마를 가진 데이터베이스 테이블과 같은 형식이 정의된 항목으로 구조화
   - RDBMS의 특징
- **반정형 데이터**는 정형 데이터에 비해 스키마가 유연하거나 생략
   - 데이터 구조에 대한 최소한의 규칙만 있으면 된다.
- **비정형 데이터**는 어떠한 내부 구조도 없다.
   - 일반 텍스트, 이미지 등
- 하둡은 처리 시점에 데이터를 해석하도록 설계
   - 비정형 데이터나 반정형 데이터도 잘 처리할 수 있다.
- **읽기 시점 스키마** 라 불리는 이러한 특성은 유연성을 제공하고 데이터를 불러오는 비용이 많이 드는 단계도 피할 수 있다.
   - 하둡은 단순 파일 복사만 필요

#### 그리드 컴퓨팅

네트워크 클러스터는 SAN으로 공유 파일시스템의 대용량 데이터에 접근 할 때 네트워크 대역폭 때문에 병목 현상이 생기고 계산 노드가 놀게 되는 문제가 발생한다. 이에 반해 하둡은 가능하면 계산 노드에 데이터를 함께 배치한다. (**데이터 지역성** Data locality)

**MPI** (**M**essage **P**assing **I**nterface)는 개발자에게 큰 제어권을 주지만, 저수준 C 루틴과 소켓과 같은 구성요소를 통해 데이터 흐름의 메커니즘을 명확하게 다룰 것을 요구한다. 하지만 하둡은 최상위 수준에서 맵리듀스의 키-값과 같은 데이터 모델의 관점에서만 생각하면 된다.

**맵리듀스**는 태스크 간의 상호 의존성이 없는 **비공유** 아키텍처

#### 자발적 컴퓨팅

**SETI**(Search for Extra-Terrestrial Intelligence)는 전파망원경의 데이터를 분석하여 외계의 지적 생명체에 대한 신호를 얻기 위해 자원봉사자들의 컴퓨터가 쉬고 있을 때 CPU의 연산력을 사용한다.

맵리듀스는  높은 네트워크 대역폭의 단일 데이터 센터에 신뢰성 높은 전용 하드웨어에서 수 분 또는 수 시간 내에 잡을 실행 할 수 있도록 설계 되었다.

이와 달리 SETI는 연결 속도가 가변적이고 데이터 지역성이 없는 신뢰할 수 없는 머신에서 오랜 시간이 걸리는 계산을 실행한다.(작업의 신뢰성을 위해 각 작업 단위는 다른 세대의 컴퓨터에 보내지고, 적어도 두 개의 결과가 같아야 그 결과를 인정 받는다.)